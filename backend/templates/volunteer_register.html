{% extends "base.html" %}
{% block title %}Регистрация доброволец{% endblock %}
{% block content %}
<div class="container mt-5 volunteer-register-container">
  <h2 class="mb-4 text-success">Стани доброволец</h2>
  <form method="POST" action="{{ url_for('volunteer_register') }}">
    <div class="mb-3">
      <label for="name" class="form-label">Име:</label>
      <input type="text" class="form-control" id="name" name="name" required>
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Имейл:</label>
      <input type="email" class="form-control" id="email" name="email" required>
    </div>
    <div class="mb-3">
      <label for="phone" class="form-label">Телефон:</label>
      <input type="text" class="form-control" id="phone" name="phone">
    </div>
    <div class="mb-3">
      <label for="location" class="form-label">Град/регион:</label>
      <input type="text" class="form-control" id="location" name="location">
    </div>
    <button type="submit" class="btn btn-success">Регистрирай се</button>
  </form>
</div>
{% endblock %}

@app.route('/volunteer_register', methods=['GET', 'POST'])
def volunteer_register():
    if request.method == 'POST':
        # name = request.form.get('name')
        # email = request.form.get('email')
        # phone = request.form.get('phone')
        # location = request.form.get('location')
        # volunteer = Volunteer(name=name, email=email, phone=phone, location=location)
        # db.session.add(volunteer)
        # db.session.commit()
        flash('Успешна регистрация! (фиктивно съобщение)')
        return redirect(url_for('volunteer_register'))
    return render_template('volunteer_register.html')

@app.route('/delete_volunteer/<int:id>', methods=['POST'])
def delete_volunteer(id):
    if not session.get('admin_logged_in'):
        return redirect(url_for('admin_login'))
    # volunteer = Volunteer.query.get_or_404(id)
    # db.session.delete(volunteer)
    # db.session.commit()
    flash('Доброволецът е изтрит успешно. (фиктивно)')
    return redirect(url_for('admin_volunteers'))

@app.route('/edit_volunteer/<int:id>', methods=['GET', 'POST'])
def edit_volunteer(id):
    if not session.get('admin_logged_in'):
        return redirect(url_for('admin_login'))
    # volunteer = Volunteer.query.get_or_404(id)
    volunteer = None
    if request.method == 'POST':
        # volunteer.name = request.form.get('name')
        # volunteer.email = request.form.get('email')
        # volunteer.phone = request.form.get('phone')
        # volunteer.location = request.form.get('location')
        # db.session.commit()
        flash('Данните са обновени успешно. (фиктивно)')
        return redirect(url_for('admin_volunteers'))
    return render_template('edit_volunteer.html', volunteer=volunteer)

@app.route('/export_volunteers')
def export_volunteers():
    if not session.get('admin_logged_in'):
        return redirect(url_for('admin_login'))
    # volunteers = Volunteer.query.all()
    volunteers = []
    si = StringIO()
    cw = csv.writer(si)
    cw.writerow(['Име', 'Имейл', 'Телефон', 'Град/регион'])
    # for v in volunteers:
    #     cw.writerow([v.name, v.email, v.phone, v.location])
    output = si.getvalue()
    return Response(
        output,
        mimetype="text/csv",
        headers={"Content-Disposition": "attachment;filename=volunteers.csv"}
    )